{% extends "base.html" %}

{% block content %}
<br />
<h1>{% block title %} Welcome back, {{ name }}! {% endblock %}</h1>
<!-- Standard Title -->
{% if current_user.indicators %}
<br />
<h2>Your Economic Calendar Dashboard</h2>
<br />
{% endif %}
<!-- Customized Title -->
{% if not current_user.indicators %}
<br />
<h2>Economic Calendar Dashboard</h2>
<br />
{% endif %}
<!-- Button to create a customized dashboard -->
{% if not current_user.indicators %}
<a href="{{ url_for('main.indicator_form') }}">
  <button type="button" class="btn btn-warning">Create Your Customized Economic Calendar</button>
</a>
<br />
{% endif %}
<br />
<!-- dashboard.html -->
<table class="table">
  <tr>
    <th>Indicator</th>
    <th>Title</th>
    <th>Value</th>
    <th>Date</th>
    <th>Previous Value</th>
    <th>Previous Date</th>
  </tr>
  {% for indicator, (title, value, date, previous_value, previous_date) in customized_data.items() %}
  <tr>
    <td>{{ indicator }}</td>
    <td>{{ title }}</td>
    <td>{{ value }}</td>
    <td>{{ date }}</td>
    <td>{{ previous_value }}</td>
    <td>{{ previous_date }}</td>
  {% endfor %}
  </tr>
</table>
<br />
{% if current_user.indicators %}
<!-- Chart -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<canvas id="myChart"></canvas>
<script type="text/javascript">
    var customized_data = {{ customized_data|tojson }};
</script>
<script type="text/javascript">
    var ctx = document.getElementById('myChart').getContext('2d');
    var myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: Object.keys(customized_data),  // Get indicator names
            datasets: [{
                label: 'Value',
                data: Object.values(customized_data).map(item => item[1]),  // Get value
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            },
            {
                label: 'Previous Value',
                data: Object.values(customized_data).map(item => item[3]),  // Get previous value
                backgroundColor: 'rgba(153, 102, 255, 0.2)',
                borderColor: 'rgba(153, 102, 255, 1)',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>
<br />
{% endif %}

{% endblock %}
